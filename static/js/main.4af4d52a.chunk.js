(this["webpackJsonpreact-morveux"]=this["webpackJsonpreact-morveux"]||[]).push([[0],{23:function(e,t,a){},44:function(e,t,a){"use strict";a.r(t);var n=a(1),c=a.n(n),s=a(17),r=a.n(s),o=(a(23),a(8)),l=a.n(o),i=a(18),d=a(2),u=a(6),b=a.n(u);function j(e){e&&(console.log("service/token setToken ".concat(e.substr(0,10),"...")),localStorage.setItem("token",e))}var h={baseURL:"https://declare-ton-morveux.herokuapp.com/",method:"get",headers:{"Content-Type":"application/json"}},m=b.a.create(h);m.interceptors.request.use((function(e){var t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e})),m.interceptors.response.use((function(e){return e}),(function(e){if(401===e.response.status)throw localStorage.removeItem("token"),new Error("Invalid token");throw e}));var p=m;function O(){return p.get("isAuthenticated")}var x=a(0);var f=function(e){var t=e.hasDeclared,a=e.setHasDeclared,n=e.setIsAuth,c=e.isAuth;return Object(x.jsx)(x.Fragment,{children:Object(x.jsx)("nav",{className:"navbar navbar-expand-lg navbar-light bg-light",children:Object(x.jsxs)("div",{className:"container-fluid",children:[Object(x.jsx)("span",{className:"navbar-brand",children:"DtM Logo"}),Object(x.jsx)("button",{className:"btn btn-outline-success",type:"submit",onClick:function(){return a(!t)},children:"D\xe9clarez un enfant"}),c&&Object(x.jsx)("button",{className:"btn btn-outline-warning",type:"submit",onClick:function(){p.post("logout").then((function(e){return n(e.data)}))},children:"Se d\xe9connecter"})]})})})},v=a(5),g=a(4);var N=function(e){var t=e.spec,a=e.handleChange,n=e.handleSubmit;return Object(x.jsxs)("div",{className:"col-sm",children:[Object(x.jsx)("h3",{children:t.header}),Object(x.jsxs)("form",{children:[Object(x.jsxs)("div",{className:"form-group text-left",children:[Object(x.jsx)("label",{htmlFor:"exampleInputEmail1",children:"Nom d'utilisateur"}),Object(x.jsx)("input",{type:"username",className:"form-control",id:t.userId,"aria-describedby":"usernameHelp",placeholder:"Entrez votre nom d'utilisateur",value:t.state.username,onChange:a}),Object(x.jsx)("small",{id:"usernameHelp",className:"form-text text-muted",children:"Nom d'utilisateur (pas l'email)"})]}),Object(x.jsxs)("div",{className:"form-group text-left",children:[Object(x.jsx)("label",{htmlFor:"exampleInputPassword1",children:"Mot de passe"}),Object(x.jsx)("input",{type:"password",className:"form-control",id:t.passId,placeholder:"Entrez votre mot de passe",autoComplete:"new-password",value:t.state.password,onChange:a})]}),Object(x.jsx)("div",{className:"form-check"}),Object(x.jsx)("button",{type:"submit",className:"btn btn-primary btn-block",onClick:n,children:t.btnValue})]})]})};var k=function(e){var t=e.setHasDeclared,a=e.hasDeclared,c=e.setIsAuth,s=Object(n.useState)({signinUsername:"",signinPassword:""}),r=Object(d.a)(s,2),o=r[0],l=r[1],i=Object(n.useState)({loginUsername:"",loginPassword:""}),u=Object(d.a)(i,2),b=u[0],h=u[1],m={header:"Cr\xe9er un compte",userId:Object.keys(o)[0],state:o,passId:Object.keys(o)[1],btnValue:"Cr\xe9er un compte"},f={header:"Se connecter",userId:Object.keys(b)[0],state:b,passId:Object.keys(b)[1],btnValue:"Se connecter"};return Object(x.jsxs)("div",{className:"container-fluid",children:[Object(x.jsx)("button",{type:"button",className:"btn btn-primary",onClick:function(){return t(!a)},children:"Retour"}),Object(x.jsxs)("div",{className:"row",children:[Object(x.jsx)("div",{className:"col-sm-6",children:Object(x.jsx)(N,{spec:m,handleChange:function(e){var t=e.target,a=t.id,n=t.value;l((function(e){return Object(g.a)(Object(g.a)({},e),{},Object(v.a)({},a,n))}))},handleSubmit:function(e){e.preventDefault();var t,a,n=o.signinUsername,s=o.signinPassword;(t=n,a=s,p.post("register",{username:t,password:a}).then((function(e){var t=e.data.token;return j(t),t}))).then((function(e){console.log(e)}),(function(){return console.log("already taken")})).catch((function(e){return alert("Sorry, there was an error")})),O().then((function(e){c(e.data)}))}})}),Object(x.jsx)("div",{className:"col-sm-6",children:Object(x.jsx)(N,{spec:f,handleChange:function(e){var t=e.target,a=t.id,n=t.value;h((function(e){return Object(g.a)(Object(g.a)({},e),{},Object(v.a)({},a,n))}))},handleSubmit:function(e){e.preventDefault();var t,a,n=b.loginUsername,s=b.loginPassword;(t=n,a=s,p.post("authenticate",{username:t,password:a}).then((function(e){var t=e.data.token;return j(t),t}))).then((function(e){O().then((function(e){c(e.data)}))})).catch((function(e){alert("Sorry, there was an error"),console.log(e)}))}})})]})]})};var y=function(e){var t=e.handleChangeSchool,a=e.passedId,n=e.schools;return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)("label",{className:"form-check-label",htmlFor:a,children:"Choisissez une \xe9cole"}),Object(x.jsx)("input",{className:"form-control",list:"school-lists",id:a,name:"school-choice",onChange:t,placeholder:"Cliquez ou entrez une \xe9cole"}),Object(x.jsx)("datalist",{id:"school-lists",children:n.map((function(e,t){return Object(x.jsx)("option",{value:e.name},e.id)}))})]})};var C=function(e){var t=e.schools,a=e.updateBrats,c=Object(n.useState)({firstName:"",lastName:""}),s=Object(d.a)(c,2),r=s[0],o=s[1],l=Object(n.useState)(),i=Object(d.a)(l,2),u=i[0],b=i[1],j=function(e){var t=e.target,a=t.id,n=t.value;o((function(e){return Object(g.a)(Object(g.a)({},e),{},Object(v.a)({},a,n))}))};return Object(x.jsx)(x.Fragment,{children:Object(x.jsxs)("form",{children:[Object(x.jsxs)("div",{className:"form-group text-left",children:[Object(x.jsx)("label",{className:"form-check-label",children:"Pr\xe9nom du morveux"}),Object(x.jsx)("input",{className:"",id:"firstName",onChange:j})]}),Object(x.jsxs)("div",{className:"form-group text-left",children:[Object(x.jsx)("label",{className:"form-check-label",children:"Nom de famille du morveux"}),Object(x.jsx)("input",{className:"",id:"lastName",onChange:j})]}),Object(x.jsx)("div",{className:"form-group text-left",children:Object(x.jsx)(y,{passedId:"add-child-shool-list",handleChangeSchool:function(e){b(e.target.value)},schools:t})}),Object(x.jsx)("div",{className:"form-check"}),Object(x.jsx)("button",{type:"button",className:"btn btn-primary",onClick:function(e){e.preventDefault();var n,c={firstName:r.firstName,lastName:r.lastName,school:{id:t.find((function(e){return e.name.includes(u)})).id}};console.log(c),(n=c,p.post("api/children",n).then((function(e){return e}))).then((function(e){return console.log(e.data)})),a()},children:"Ajoutez"})]})})};var S=function(e){var t=e.setHasDeclared,a=e.hasDeclared,c=e.myBrats,s=Object(n.useState)([]),r=Object(d.a)(s,2),o=r[0],l=r[1];Object(n.useEffect)((function(){var e=c.map((function(e){return[e.contagious,e.sick]}));l(e),console.log(e)}),[]),console.log(c);var i=function(e){var t=e.target,a=t.id,n=t.checked,c=t.name,s=e.target.getAttribute("data-key");o[s]="contagious"==a?[n,o[s][1]]:[o[s][0],n],console.log(o[s]),console.log(e.target.getAttribute("data-key")),console.log("handlechange",a,n,c)},u=function(e){e.preventDefault();var n=e.target.getAttribute("data-key");o[n];t(!a)};return Object(x.jsx)(x.Fragment,{children:c&&c.length>0?Object(x.jsx)(x.Fragment,{children:c.map((function(e,t){return Object(x.jsxs)("form",{"data-key":t,className:"form-check border-bottom border-1",children:[Object(x.jsxs)("div",{className:"mb-3 row",children:[Object(x.jsx)("label",{htmlFor:e.firstName,className:"col-sm-8 col-form-label",children:"Le pr\xe9nom du morveux :"}),Object(x.jsx)("div",{className:"col-sm-4",children:Object(x.jsx)("input",{type:"text",readOnly:!0,className:"form-control-plaintext",id:e.firstName,value:e.firstName})})]}),Object(x.jsxs)("div",{className:"mb-3",children:[Object(x.jsx)("label",{className:"form-check-label",htmlFor:"sick",children:"malade"}),Object(x.jsx)("input",{className:"form-check-input",type:"checkbox",name:e.i,id:"sick",indeterminate:e.sick.toString(),onChange:i,defaultChecked:e.sick,"data-key":t})]}),Object(x.jsxs)("div",{className:"mb-3",children:[Object(x.jsx)("label",{className:"form-check-label",htmlFor:"contagious",children:"contagieux"}),Object(x.jsx)("input",{className:"form-check-input",type:"checkbox",name:e.i,id:"contagious",indeterminate:e.contagious.toString(),onChange:i,defaultChecked:e.contagious,"data-key":t})]}),Object(x.jsx)("button",{id:e.id,className:"btn btn-primary mb-2",onClick:u,children:"Mettre \xe0 jour l'\xe9tat de ce morveux"})]},t)}))}):Object(x.jsx)("p",{children:"Vous n'avez pas de morveux inscrit"})})};var w=function(e){var t=e.setHasDeclared,a=e.hasDeclared,n=e.schools,c=e.myBrats,s=e.updateBrats;return Object(x.jsxs)("div",{className:"",children:[Object(x.jsx)("button",{type:"button",className:"btn btn-primary",onClick:function(){return t(!a)},children:"Retour"}),Object(x.jsxs)("div",{className:"accordion",id:"accordionExample",children:[Object(x.jsxs)("div",{className:"accordion-item",children:[Object(x.jsx)("h2",{className:"accordion-header",id:"headingOne",children:Object(x.jsx)("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseOne","aria-expanded":"false","aria-controls":"collapseOne",children:"Ajouter un morveux"})}),Object(x.jsx)("div",{id:"collapseOne",className:"accordion-collapse collapse show","aria-labelledby":"headingOne","data-bs-parent":"#accordionExample",children:Object(x.jsx)("div",{className:"accordion-body",children:Object(x.jsx)(C,{updateBrats:s,schools:n})})})]}),Object(x.jsxs)("div",{className:"accordion-item",children:[Object(x.jsx)("h2",{className:"accordion-header",id:"headingTwo",children:Object(x.jsx)("button",{className:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseTwo","aria-expanded":"true","aria-controls":"collapseTwo",onClick:function(){},children:"Liste de morveux"})}),Object(x.jsx)("div",{id:"collapseTwo",className:"accordion-collapse collapse","aria-labelledby":"headingTwo","data-bs-parent":"#accordionExample",children:Object(x.jsx)("div",{className:"accordion-body",children:Object(x.jsx)(S,{setHasDeclared:t,hasDeclared:a,myBrats:c})})})]})]})]})};var D=function(){var e=Object(n.useState)(!1),t=Object(d.a)(e,2),a=t[0],c=t[1],s=Object(n.useState)(0),r=Object(d.a)(s,2),o=r[0],u=r[1],j=Object(n.useState)([]),h=Object(d.a)(j,2),m=h[0],v=h[1],g=Object(n.useState)(),N=Object(d.a)(g,2),C=N[0],S=N[1],D=Object(n.useState)(!1),I=Object(d.a)(D,2),F=I[0],A=I[1],z=Object(n.useState)(),B=Object(d.a)(z,2),L=B[0],E=B[1],H=Object(n.useState)(),T=Object(d.a)(H,2),P=T[0],M=T[1],U=Object(n.useState)(!1),V=Object(d.a)(U,2),R=V[0],q=(V[1],function(){p.get("api/parents/me").then((function(e){return e})).then((function(e){return(t=e.data.id,p.get("api/children/parent/".concat(t)).then((function(e){return e}))).then((function(e){M(e.data)}));var t}))});return Object(n.useEffect)((function(){q(),O().then((function(e){return A(e.data)})),p.get("/api/schools").then((function(e){return e})).then((function(e){return v(e.data)})),function(){var e=Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.get("https://declare-ton-morveux.herokuapp.com/api/children/sick").then((function(e){return console.log(e.data),e.data}));case 2:t=e.sent,u(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[]),a&&!F?Object(x.jsx)(k,{setHasDeclared:c,hasDeclared:a,setIsAuth:A}):a&&F?Object(x.jsx)(w,{updateBrats:q,setHasDeclared:c,hasDeclared:a,schools:m,myBrats:P,isLoaded:R}):Object(x.jsxs)("div",{className:"container-fluid",children:[Object(x.jsx)(f,{setHasDeclared:c,setIsAuth:A,isAuth:F}),Object(x.jsxs)("h1",{className:"text-center mb-3",children:["Bienvenue sur ",Object(x.jsx)("br",{})," D\xe9clare ton Morveux"]}),Object(x.jsxs)("h2",{className:"text-center mb-3",children:["Le total de morveux est de : ",o.sick]}),Object(x.jsxs)("h3",{className:"text-center mb-3",children:["Le total de morveux ",Object(x.jsx)("b",{children:"contagieux"})," est de : ",o.contagious]}),Object(x.jsxs)("form",{children:[Object(x.jsx)("div",{className:"form-group text-left",children:Object(x.jsx)(y,{passedId:"school-choice",handleChangeSchool:function(e){S(e.target.value)},schools:m})}),Object(x.jsx)("button",{type:"button",className:"btn btn-primary",onClick:function(e){e.preventDefault();var t,a=m.find((function(e){return e.name.includes(C)}));a&&(t=a.id,p.get("api/schools/".concat(t)).then((function(e){return e}))).then((function(e){return E(e.data)}))},children:"Recherchez"})]}),L&&(L.children.length>0?Object(x.jsxs)("div",{className:"mt-3 pt-3 border-top border-2",children:[Object(x.jsxs)("p",{children:["Liste de morveux inscrit \xe0 l'",L.name,Object(x.jsx)("br",{}),Object(x.jsxs)("small",{children:['Vous pouvez les pointer du doigt et criez "',Object(x.jsx)("b",{children:"Ah ! Les p'tits morveux !"}),'"']})]}),Object(x.jsx)("ul",{children:L.children.map((function(e,t){return Object(x.jsxs)("li",{children:[e.firstName," ",e.lastName]},t)}))})]}):Object(x.jsx)("div",{className:"mt-3 pt-3 border-top border-2",children:Object(x.jsxs)("p",{children:["Il n'y a pas de morveux \xe0 ",L.name,"."]})}))]})},I=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,45)).then((function(t){var a=t.getCLS,n=t.getFID,c=t.getFCP,s=t.getLCP,r=t.getTTFB;a(e),n(e),c(e),s(e),r(e)}))};r.a.render(Object(x.jsx)(c.a.StrictMode,{children:Object(x.jsx)(D,{})}),document.getElementById("root")),I()}},[[44,1,2]]]);
//# sourceMappingURL=main.4af4d52a.chunk.js.map