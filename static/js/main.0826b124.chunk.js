(this["webpackJsonpreact-morveux"]=this["webpackJsonpreact-morveux"]||[]).push([[0],{21:function(e,t,n){},41:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),s=n(15),r=n.n(s),o=(n(21),n(2)),l=n(16);function i(e){e&&(console.log("service/token setToken ".concat(e.substr(0,10),"...")),localStorage.setItem("token",e))}var d={baseURL:"https://declare-ton-morveux.herokuapp.com/",method:"get",headers:{"Content-Type":"application/json"}},u=n.n(l).a.create(d);u.interceptors.request.use((function(e){var t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e})),u.interceptors.response.use((function(e){return e}),(function(e){if(401===e.response.status)throw localStorage.removeItem("token"),new Error("Invalid token");throw e}));var j=u;function b(){return j.get("isAuthenticated").then((function(e){return e}))}var h=n(0);var m=function(e){var t=e.hasDeclared,n=e.setHasDeclared,a=e.setIsAuth,c=e.isAuth;return Object(h.jsx)(h.Fragment,{children:Object(h.jsx)("nav",{className:"navbar navbar-expand-lg navbar-light bg-light",children:Object(h.jsxs)("div",{className:"container-fluid",children:[Object(h.jsx)("span",{className:"navbar-brand",children:"DtM Logo"}),Object(h.jsx)("button",{className:"btn btn-outline-success",type:"submit",onClick:function(){return n(!t)},children:"D\xe9clarez un enfant"}),c&&Object(h.jsx)("button",{className:"btn btn-outline-warning",type:"submit",onClick:function(){j.post("logout").then((function(e){return a(e.data)}))},children:"Se d\xe9connecter"})]})})})},p=n(5),O=n(4);var x=function(e){var t=e.spec,n=e.handleChange,a=e.handleSubmit;return Object(h.jsxs)("div",{className:"col-sm",children:[Object(h.jsx)("h3",{children:t.header}),Object(h.jsxs)("form",{children:[Object(h.jsxs)("div",{className:"form-group text-left",children:[Object(h.jsx)("label",{htmlFor:"exampleInputEmail1",children:"Nom d'utilisateur"}),Object(h.jsx)("input",{type:"username",className:"form-control",id:t.userId,"aria-describedby":"usernameHelp",placeholder:"Entrez votre nom d'utilisateur",value:t.state.username,onChange:n}),Object(h.jsx)("small",{id:"usernameHelp",className:"form-text text-muted",children:"Nom d'utilisateur (pas l'email)"})]}),Object(h.jsxs)("div",{className:"form-group text-left",children:[Object(h.jsx)("label",{htmlFor:"exampleInputPassword1",children:"Mot de passe"}),Object(h.jsx)("input",{type:"password",className:"form-control",id:t.passId,placeholder:"Entrez votre mot de passe",autoComplete:"new-password",value:t.state.password,onChange:n})]}),Object(h.jsx)("div",{className:"form-check"}),Object(h.jsx)("button",{type:"submit",className:"btn btn-primary btn-block",onClick:a,children:t.btnValue})]})]})};var f=function(e){var t=e.setHasDeclared,n=e.hasDeclared,c=e.setIsAuth,s=Object(a.useState)({signinUsername:"",signinPassword:""}),r=Object(o.a)(s,2),l=r[0],d=r[1],u=Object(a.useState)({loginUsername:"",loginPassword:""}),m=Object(o.a)(u,2),f=m[0],v=m[1],g={header:"Cr\xe9er un compte",userId:Object.keys(l)[0],state:l,passId:Object.keys(l)[1],btnValue:"Cr\xe9er un compte"},N={header:"Se connecter",userId:Object.keys(f)[0],state:f,passId:Object.keys(f)[1],btnValue:"Se connecter"};return Object(h.jsxs)("div",{className:"container-fluid",children:[Object(h.jsx)("button",{type:"button",className:"btn btn-primary",onClick:function(){return t(!n)},children:"Retour"}),Object(h.jsxs)("div",{className:"row",children:[Object(h.jsx)("div",{className:"col-sm-6",children:Object(h.jsx)(x,{spec:g,handleChange:function(e){var t=e.target,n=t.id,a=t.value;d((function(e){return Object(O.a)(Object(O.a)({},e),{},Object(p.a)({},n,a))}))},handleSubmit:function(e){e.preventDefault();var t,n,a=l.signinUsername,s=l.signinPassword;(t=a,n=s,j.post("register",{username:t,password:n}).then((function(e){var t=e.data.token;return i(t),t}))).then((function(e){console.log(e)}),(function(){return console.log("already taken")})).catch((function(e){return alert("Sorry, there was an error")})),b().then((function(e){c(e.data)}))}})}),Object(h.jsx)("div",{className:"col-sm-6",children:Object(h.jsx)(x,{spec:N,handleChange:function(e){var t=e.target,n=t.id,a=t.value;v((function(e){return Object(O.a)(Object(O.a)({},e),{},Object(p.a)({},n,a))}))},handleSubmit:function(e){e.preventDefault();var t,n,a=f.loginUsername,s=f.loginPassword;(t=a,n=s,j.post("authenticate",{username:t,password:n}).then((function(e){var t=e.data.token;return i(t),t}))).then((function(e){})).catch((function(e){alert("Sorry, there was an error"),console.log(e)})),b().then((function(e){c(e.data)}))}})})]})]})};var v=function(e){var t=e.handleChangeSchool,n=e.passedId,a=e.schools;return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)("label",{htmlFor:n,children:"Choisissez une \xe9cole :"}),Object(h.jsx)("input",{list:"school-lists",id:n,name:"school-choice",onChange:t,placeholder:"Cliquez ou entrez une \xe9cole"}),Object(h.jsx)("datalist",{id:"school-lists",children:a.map((function(e,t){return Object(h.jsx)("option",{value:e.name},e.id)}))})]})};var g=function(e){var t=e.schools,n=Object(a.useState)({firstName:"",lastName:""}),c=Object(o.a)(n,2),s=c[0],r=c[1],l=Object(a.useState)(),i=Object(o.a)(l,2),d=i[0],u=i[1],b=function(e){var t=e.target,n=t.id,a=t.value;r((function(e){return Object(O.a)(Object(O.a)({},e),{},Object(p.a)({},n,a))}))};return Object(h.jsx)(h.Fragment,{children:Object(h.jsxs)("form",{children:[Object(h.jsxs)("div",{className:"form-group text-left",children:[Object(h.jsx)("label",{children:"Pr\xe9nom du morveux :"}),Object(h.jsx)("input",{id:"firstName",onChange:b})]}),Object(h.jsxs)("div",{className:"form-group text-left",children:[Object(h.jsx)("label",{children:"Nom de famille du morveux :"}),Object(h.jsx)("input",{id:"lastName",onChange:b})]}),Object(h.jsx)("div",{className:"form-group text-left",children:Object(h.jsx)(v,{passedId:"add-child-shool-list",handleChangeSchool:function(e){u(e.target.value)},schools:t})}),Object(h.jsx)("div",{className:"form-check"}),Object(h.jsx)("button",{type:"button",className:"btn btn-primary",onClick:function(e){e.preventDefault();var n={firstName:s.firstName,lastName:s.lastName,school:{id:t.find((function(e){return e.name.includes(d)})).id}};console.log(n),function(e){var t=e.obj;return j.post("api/children",t).then((function(e){return e}))}(n).then((function(e){return console.log(e.data)}))},children:"Ajoutez"})]})})};var N=function(e){var t=e.setHasDeclared,n=e.hasDeclared,a=e.myBrats;return Object(h.jsx)(h.Fragment,{children:a&&a.length>0?Object(h.jsxs)(h.Fragment,{children:[a.map((function(e,t){return Object(h.jsxs)("div",{className:"form-check",children:[Object(h.jsxs)("div",{className:"mb-3 row",children:[Object(h.jsx)("label",{htmlFor:e.firstName,className:"col-sm-2 col-form-label",children:"Le pr\xe9nom du morveux"}),Object(h.jsx)("div",{className:"col-sm-10",children:Object(h.jsx)("input",{type:"text",readonly:!0,className:"form-control-plaintext",id:e.firstName,value:e.firstName})})]}),Object(h.jsxs)("div",{className:"mb-3 row",children:[Object(h.jsx)("label",{className:"form-check-label",htmlFor:"malade",children:"malade"}),Object(h.jsx)("input",{className:"form-check-input",type:"radio",name:"child",id:"malade"})]}),Object(h.jsxs)("div",{className:"mb-3 row",children:[Object(h.jsx)("label",{className:"form-check-label",htmlFor:"contagieux",children:"contagieux"}),Object(h.jsx)("input",{className:"form-check-input",type:"radio",name:"child",id:"contagieux"})]})]},t)})),Object(h.jsxs)("button",{className:"btn btn-primary",onClick:function(){return t(!n)},children:["Mettre \xe0 jour l'\xe9tat"," ",a.length>1?"des enfants":"de l'enfant"]})]}):Object(h.jsx)("p",{children:"Vous n'avez pas de morveux inscrit"})})};var y=function(e){var t=e.setHasDeclared,n=e.hasDeclared,c=e.schools,s=Object(a.useState)(),r=Object(o.a)(s,2),l=r[0],i=r[1];return Object(h.jsxs)("div",{className:"",children:[Object(h.jsx)("button",{type:"button",className:"btn btn-primary",onClick:function(){return t(!n)},children:"Retour"}),Object(h.jsxs)("div",{className:"accordion",id:"accordionExample",children:[Object(h.jsxs)("div",{className:"accordion-item",children:[Object(h.jsx)("h2",{className:"accordion-header",id:"headingOne",children:Object(h.jsx)("button",{className:"accordion-button",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseOne","aria-expanded":"false","aria-controls":"collapseOne",children:"Ajouter un morveux"})}),Object(h.jsx)("div",{id:"collapseOne",className:"accordion-collapse collapse show","aria-labelledby":"headingOne","data-bs-parent":"#accordionExample",children:Object(h.jsx)("div",{className:"accordion-body",children:Object(h.jsx)(g,{schools:c})})})]}),Object(h.jsxs)("div",{className:"accordion-item",children:[Object(h.jsx)("h2",{className:"accordion-header",id:"headingTwo",children:Object(h.jsx)("button",{className:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseTwo","aria-expanded":"true","aria-controls":"collapseTwo",onClick:function(){j.get("api/parents/me").then((function(e){return e})).then((function(e){return(t=e.data.id,j.get("api/children/parent/".concat(t)).then((function(e){return e}))).then((function(e){return i(e.data)}));var t}))},children:"Liste de morveux"})}),Object(h.jsx)("div",{id:"collapseTwo",className:"accordion-collapse collapse","aria-labelledby":"headingTwo","data-bs-parent":"#accordionExample",children:Object(h.jsx)("div",{className:"accordion-body",children:Object(h.jsx)(N,{setHasDeclared:t,hasDeclared:n,myBrats:l})})})]})]})]})};var k=function(){var e=Object(a.useState)(!1),t=Object(o.a)(e,2),n=t[0],c=t[1],s=Object(a.useState)(0),r=Object(o.a)(s,2),l=r[0],i=r[1],d=Object(a.useState)([]),u=Object(o.a)(d,2),p=u[0],O=u[1],x=Object(a.useState)(),g=Object(o.a)(x,2),N=g[0],k=g[1],w=Object(a.useState)(),C=Object(o.a)(w,2),S=C[0],D=C[1],I=Object(a.useState)(),F=Object(o.a)(I,2),z=F[0],A=F[1];return Object(a.useEffect)((function(){b().then((function(e){return D(e.data)})),j.get("/api/schools").then((function(e){return e})).then((function(e){return O(e.data)})),j.get("api/children/sick").then((function(e){return e})).then((function(e){return i(e.data.sick)}))}),[]),n&&!S?Object(h.jsx)(f,{setHasDeclared:c,hasDeclared:n,setIsAuth:D}):n&&S?Object(h.jsx)(y,{setHasDeclared:c,hasDeclared:n,schools:p}):Object(h.jsxs)("div",{className:"contaier-fluid",children:[Object(h.jsx)(m,{setHasDeclared:c,setIsAuth:D,isAuth:S}),Object(h.jsxs)("h1",{className:"text-center mb-3",children:["Bienvenue sur ",Object(h.jsx)("br",{})," D\xe9clare ton Morveux"]}),Object(h.jsxs)("h2",{className:"text-center mb-3",children:["Le total de morveux est de : ",l]}),Object(h.jsxs)("form",{children:[Object(h.jsx)("div",{className:"form-group text-left",children:Object(h.jsx)(v,{passedId:"school-choice",handleChangeSchool:function(e){k(e.target.value)},schools:p})}),Object(h.jsx)("button",{type:"button",className:"btn btn-primary",onClick:function(e){e.preventDefault();var t,n=p.find((function(e){return e.name.includes(N)}));n&&(t=n.id,j.get("api/schools/".concat(t)).then((function(e){return e}))).then((function(e){return A(e.data)}))},children:"Recherchez"})]}),z&&(z.children.length>0?Object(h.jsxs)("div",{className:"mt-3 pt-3 border-top border-2",children:[Object(h.jsxs)("p",{children:["Liste de morveux inscrit \xe0 l'",z.name,Object(h.jsx)("br",{}),Object(h.jsxs)("small",{children:['Vous pouvez les pointer du doigt et criez "',Object(h.jsx)("b",{children:"Ah ! Les p'tits morveux !"}),'"']})]}),Object(h.jsx)("ul",{children:z.children.map((function(e,t){return Object(h.jsxs)("li",{children:[e.firstName," ",e.lastName]},t)}))})]}):Object(h.jsx)("div",{className:"mt-3 pt-3 border-top border-2",children:Object(h.jsxs)("p",{children:["Il n'y a pas de morveux \xe0 ",z.name,"."]})}))]})},w=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,42)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,s=t.getLCP,r=t.getTTFB;n(e),a(e),c(e),s(e),r(e)}))};r.a.render(Object(h.jsx)(c.a.StrictMode,{children:Object(h.jsx)(k,{})}),document.getElementById("root")),w()}},[[41,1,2]]]);
//# sourceMappingURL=main.0826b124.chunk.js.map